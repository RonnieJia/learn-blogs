(window.webpackJsonp=window.webpackJsonp||[]).push([[15],{422:function(n,s,e){"use strict";e.r(s);var a=e(2),t=Object(a.a)({},(function(){var n=this,s=n._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":n.$parent.slotKey}},[s("h3",{attrs:{id:"前言"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#前言"}},[n._v("#")]),n._v(" 前言")]),n._v(" "),s("p",[n._v("设计模式是对代码开发经验的总结，是解决特定问题的一系列套路。它不是语法规定，而是一套用来提高代码可复用性、可维护性、可读性、稳定性及安全性的解决方案。")]),n._v(" "),s("h3",{attrs:{id:"_1-mvc"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-mvc"}},[n._v("#")]),n._v(" 1. MVC")]),n._v(" "),s("p",[n._v("苹果官方建议使用MVC进行iOS开发，而且目前大部分公司的项目都是使用的该模式开发。\nMVC是由Model、View、Controller组成，其中通过Controller将Model关联到View。")]),n._v(" "),s("p",[s("img",{attrs:{src:"mvc.png",alt:"MVC"}})]),n._v(" "),s("p",[n._v("Model：数据层，负责读写数据，保存App的状态等；\nView：UI层，负责UI布局显示；\nController：业务逻辑层，负责业务逻辑、事件响应、数据加工等；")]),n._v(" "),s("p",[n._v("当App的交互、逻辑复杂时，Controller就会变得非常臃肿，导致难以维护、扩展，增加了开发的难度，降低了效率。")]),n._v(" "),s("h3",{attrs:{id:"_2-mvvm"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-mvvm"}},[n._v("#")]),n._v(" 2. MVVM")]),n._v(" "),s("p",[s("img",{attrs:{src:"mvvm.png",alt:"MVVM"}})]),n._v(" "),s("p",[n._v("ViewModel：业务逻辑层，将用户行为转换为状态输出；\nController：负责数据绑定；\nMVVM中ViewModel负责业务逻辑从而将Controller瘦身，并且可以逻辑的复用性。MVVM可以大大降低代码的耦合性，方便进行单元测试以及维护，也方便多人协作开发。")]),n._v(" "),s("h3",{attrs:{id:"_3-项目实战"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-项目实战"}},[n._v("#")]),n._v(" 3. 项目实战")]),n._v(" "),s("p",[n._v("项目整体使用了RxSwift+MVVM+Moya的架构，其中ViewModel的协议定义为：")]),n._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[n._v("protocol ViewModelType {\n    associatedtype Input\n    associatedtype Output\n    \n    func transform(input: Input) -> Output\n}\n")])]),n._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[n._v("1")]),s("br"),s("span",{staticClass:"line-number"},[n._v("2")]),s("br"),s("span",{staticClass:"line-number"},[n._v("3")]),s("br"),s("span",{staticClass:"line-number"},[n._v("4")]),s("br"),s("span",{staticClass:"line-number"},[n._v("5")]),s("br"),s("span",{staticClass:"line-number"},[n._v("6")]),s("br")])]),s("p",[n._v("ViewModel的核心逻辑就是将Input(用户行为等)转换为Output(需要绑定到View的数据)，拿登录流程来说，\n登录的ViewModel为：")]),n._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[n._v("class LoginViewModel: GTSViewModel, GTSViewModelType {\n    struct Input {\n        let loginTrigger: Driver<Void>\n        let userName: Driver<String?>\n        let pwd: Driver<String?>\n    }\n    \n    struct Output {\n        let loginButtonEnable: Driver<Bool>\n        let loginState: Driver<Bool>\n    }\n    \n    func transform(input: Input) -> Output {\n        let loginStatus = BehaviorRelay<Bool>(value: false)\n        let loginBtnEnable = BehaviorRelay<Bool>(value: false)\n        \n        input.loginTrigger.drive(onNext: {\n            // 调用登录接口\n            if (true) {\n                loginStatus.accept(true)\n            }\n        }).disposed(by: rx.disposeBag)\n        \n        BehaviorRelay.combineLatest(input.userName.asObservable(), input.pwd.asObservable()) {\n            return $0.isValidMobile && $1.count >= 6\n        }.subscribe { enable in\n            loginBtnEnable.accept(enable)\n        }.disposed(by: rx.disposeBag)\n        \n        return Output(\n            loginButtonEnable: loginBtnEnable.asDriver(),\n            loginState: loginStatus.asDriver()\n        )\n    }\n}\n")])]),n._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[n._v("1")]),s("br"),s("span",{staticClass:"line-number"},[n._v("2")]),s("br"),s("span",{staticClass:"line-number"},[n._v("3")]),s("br"),s("span",{staticClass:"line-number"},[n._v("4")]),s("br"),s("span",{staticClass:"line-number"},[n._v("5")]),s("br"),s("span",{staticClass:"line-number"},[n._v("6")]),s("br"),s("span",{staticClass:"line-number"},[n._v("7")]),s("br"),s("span",{staticClass:"line-number"},[n._v("8")]),s("br"),s("span",{staticClass:"line-number"},[n._v("9")]),s("br"),s("span",{staticClass:"line-number"},[n._v("10")]),s("br"),s("span",{staticClass:"line-number"},[n._v("11")]),s("br"),s("span",{staticClass:"line-number"},[n._v("12")]),s("br"),s("span",{staticClass:"line-number"},[n._v("13")]),s("br"),s("span",{staticClass:"line-number"},[n._v("14")]),s("br"),s("span",{staticClass:"line-number"},[n._v("15")]),s("br"),s("span",{staticClass:"line-number"},[n._v("16")]),s("br"),s("span",{staticClass:"line-number"},[n._v("17")]),s("br"),s("span",{staticClass:"line-number"},[n._v("18")]),s("br"),s("span",{staticClass:"line-number"},[n._v("19")]),s("br"),s("span",{staticClass:"line-number"},[n._v("20")]),s("br"),s("span",{staticClass:"line-number"},[n._v("21")]),s("br"),s("span",{staticClass:"line-number"},[n._v("22")]),s("br"),s("span",{staticClass:"line-number"},[n._v("23")]),s("br"),s("span",{staticClass:"line-number"},[n._v("24")]),s("br"),s("span",{staticClass:"line-number"},[n._v("25")]),s("br"),s("span",{staticClass:"line-number"},[n._v("26")]),s("br"),s("span",{staticClass:"line-number"},[n._v("27")]),s("br"),s("span",{staticClass:"line-number"},[n._v("28")]),s("br"),s("span",{staticClass:"line-number"},[n._v("29")]),s("br"),s("span",{staticClass:"line-number"},[n._v("30")]),s("br"),s("span",{staticClass:"line-number"},[n._v("31")]),s("br"),s("span",{staticClass:"line-number"},[n._v("32")]),s("br"),s("span",{staticClass:"line-number"},[n._v("33")]),s("br"),s("span",{staticClass:"line-number"},[n._v("34")]),s("br"),s("span",{staticClass:"line-number"},[n._v("35")]),s("br")])]),s("p",[n._v("Controller为：")]),n._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[n._v('class LoginViewController: UIViewController {\n    override func viewDidLoad() {\n        super.viewDidLoad()\n        \n        makeUI()\n        bindViewModel()\n    }\n    \n    private func makeUI() {\n        view.addSubviews([userName, pwd, loginBtn])\n        userName.snp.makeConstraints { make in\n            make.left.right.equalToSuperview().inset(20)\n            make.top.equalToSuperview().inset(40)\n            make.height.equalTo(45)\n        }\n        pwd.snp.makeConstraints { make in\n            make.left.right.height.equalTo(userName)\n            make.top.equalTo(userName.snp.bottom).offset(20)\n        }\n        loginBtn.snp.makeConstraints { make in\n            make.left.right.bottom.equalToSuperview().inset(40)\n            make.height.equalTo(45)\n        }\n    }\n    \n    private func bindViewModel() {\n        let input = LoginViewModel.Input(\n            loginTrigger: loginBtn.rx.tap.asDriver(),\n            userName: userName.rx.text.asDriver(),\n            pwd: pwd.rx.text.asDriver()\n        )\n        let output = viewModel.transform(input: input)\n        output.loginButtonEnable.drive(loginBtn.rx.isEnabled).disposed(by: rx.disposeBag)\n        output.loginState.drive( onNext: { suc in\n            // 登录成功\n        }).disposed(by: rx.disposeBag)\n    }\n    \n    private lazy var viewModel: LoginViewModel = {\n       return LoginViewModel()\n    }()\n    \n    private lazy var userName: UITextField = {\n        let userName = UITextField()\n        userName.placeholder = "请输入用户名"\n        return userName\n    }()\n    \n    private lazy var pwd: UITextField = {\n        let pwd = UITextField()\n        pwd.placeholder = "请输入密码"\n        pwd.isSecureTextEntry = true\n        return pwd\n    }()\n    \n    lazy var loginBtn: UIButton = {\n        let btn = UIButton(type: .custom)\n        btn.setTitle("登录", for: .normal)\n        return btn\n    }()\n}\n')])]),n._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[n._v("1")]),s("br"),s("span",{staticClass:"line-number"},[n._v("2")]),s("br"),s("span",{staticClass:"line-number"},[n._v("3")]),s("br"),s("span",{staticClass:"line-number"},[n._v("4")]),s("br"),s("span",{staticClass:"line-number"},[n._v("5")]),s("br"),s("span",{staticClass:"line-number"},[n._v("6")]),s("br"),s("span",{staticClass:"line-number"},[n._v("7")]),s("br"),s("span",{staticClass:"line-number"},[n._v("8")]),s("br"),s("span",{staticClass:"line-number"},[n._v("9")]),s("br"),s("span",{staticClass:"line-number"},[n._v("10")]),s("br"),s("span",{staticClass:"line-number"},[n._v("11")]),s("br"),s("span",{staticClass:"line-number"},[n._v("12")]),s("br"),s("span",{staticClass:"line-number"},[n._v("13")]),s("br"),s("span",{staticClass:"line-number"},[n._v("14")]),s("br"),s("span",{staticClass:"line-number"},[n._v("15")]),s("br"),s("span",{staticClass:"line-number"},[n._v("16")]),s("br"),s("span",{staticClass:"line-number"},[n._v("17")]),s("br"),s("span",{staticClass:"line-number"},[n._v("18")]),s("br"),s("span",{staticClass:"line-number"},[n._v("19")]),s("br"),s("span",{staticClass:"line-number"},[n._v("20")]),s("br"),s("span",{staticClass:"line-number"},[n._v("21")]),s("br"),s("span",{staticClass:"line-number"},[n._v("22")]),s("br"),s("span",{staticClass:"line-number"},[n._v("23")]),s("br"),s("span",{staticClass:"line-number"},[n._v("24")]),s("br"),s("span",{staticClass:"line-number"},[n._v("25")]),s("br"),s("span",{staticClass:"line-number"},[n._v("26")]),s("br"),s("span",{staticClass:"line-number"},[n._v("27")]),s("br"),s("span",{staticClass:"line-number"},[n._v("28")]),s("br"),s("span",{staticClass:"line-number"},[n._v("29")]),s("br"),s("span",{staticClass:"line-number"},[n._v("30")]),s("br"),s("span",{staticClass:"line-number"},[n._v("31")]),s("br"),s("span",{staticClass:"line-number"},[n._v("32")]),s("br"),s("span",{staticClass:"line-number"},[n._v("33")]),s("br"),s("span",{staticClass:"line-number"},[n._v("34")]),s("br"),s("span",{staticClass:"line-number"},[n._v("35")]),s("br"),s("span",{staticClass:"line-number"},[n._v("36")]),s("br"),s("span",{staticClass:"line-number"},[n._v("37")]),s("br"),s("span",{staticClass:"line-number"},[n._v("38")]),s("br"),s("span",{staticClass:"line-number"},[n._v("39")]),s("br"),s("span",{staticClass:"line-number"},[n._v("40")]),s("br"),s("span",{staticClass:"line-number"},[n._v("41")]),s("br"),s("span",{staticClass:"line-number"},[n._v("42")]),s("br"),s("span",{staticClass:"line-number"},[n._v("43")]),s("br"),s("span",{staticClass:"line-number"},[n._v("44")]),s("br"),s("span",{staticClass:"line-number"},[n._v("45")]),s("br"),s("span",{staticClass:"line-number"},[n._v("46")]),s("br"),s("span",{staticClass:"line-number"},[n._v("47")]),s("br"),s("span",{staticClass:"line-number"},[n._v("48")]),s("br"),s("span",{staticClass:"line-number"},[n._v("49")]),s("br"),s("span",{staticClass:"line-number"},[n._v("50")]),s("br"),s("span",{staticClass:"line-number"},[n._v("51")]),s("br"),s("span",{staticClass:"line-number"},[n._v("52")]),s("br"),s("span",{staticClass:"line-number"},[n._v("53")]),s("br"),s("span",{staticClass:"line-number"},[n._v("54")]),s("br"),s("span",{staticClass:"line-number"},[n._v("55")]),s("br"),s("span",{staticClass:"line-number"},[n._v("56")]),s("br"),s("span",{staticClass:"line-number"},[n._v("57")]),s("br"),s("span",{staticClass:"line-number"},[n._v("58")]),s("br"),s("span",{staticClass:"line-number"},[n._v("59")]),s("br"),s("span",{staticClass:"line-number"},[n._v("60")]),s("br"),s("span",{staticClass:"line-number"},[n._v("61")]),s("br")])])])}),[],!1,null,null,null);s.default=t.exports}}]);